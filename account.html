<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Account - Devotee Bus Ticketing System</title>
  <style>
    /* Material Design inspired styles */
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      font-size: 1.6rem; /* Large font for elderly users */
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      flex-direction: colunm;
      gap: 2rem;
    }
    .container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 90%;
      padding: 2rem;
      text-align: center;
    }
    h1 {
      font-weight: 700;
      margin-bottom: 1rem;
      color: #6200ee;
    }
    .profile-field {
      margin: 1rem 0;
      text-align: left;
    }
    .profile-label {
      font-weight: 600;
      color: #555;
      display: block;
      margin-bottom: 0.3rem;
    }
    .profile-value {
      font-size: 1.4rem;
      color: #222;
    }
    .badge {
      display: inline-block;
      background-color: #ff9800;
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 12px;
      font-weight: 600;
      margin-top: 0.5rem;
      font-size: 1.2rem;
    }
    button {
      background-color: #6200ee;
      color: white;
      border: none;
      border-radius: 24px;
      padding: 0.8rem 2rem;
      font-size: 1.4rem;
      font-weight: 600;
      cursor: pointer;
      margin: 1rem 0.5rem 0 0.5rem;
      transition: background-color 0.3s ease;
    }
    button:hover, button:focus {
      background-color: #3700b3;
      outline: none;
    }
    /* Modal styles */
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 8px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      text-align: left;
    }
    .modal-content h2 {
      margin-top: 0;
      color: #6200ee;
    }
    .modal-content label {
      display: block;
      margin: 1rem 0 0.3rem 0;
      font-weight: 600;
      color: #555;
    }
    .modal-content input, .modal-content select {
      width: 100%;
      padding: 0.6rem;
      font-size: 1.4rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .modal-buttons {
      margin-top: 1.5rem;
      text-align: right;
    }
    .modal-buttons button {
      margin-left: 1rem;
    }
    /* Responsive */
    @media (max-width: 480px) {
      body {
        font-size: 1.4rem;
      }
      button {
        width: 100%;
        margin: 0.5rem 0 0 0;
      }
      .modal-buttons {
        text-align: center;
      }
      .modal-buttons button {
        margin: 0.5rem 0 0 0;
        width: 45%;
      }
    }
  </style>
</head>
<body>
  <div id="profileInputForm" class="container" role="main" aria-label="Enter Profile Details" style="display:none;">
    <h1>Enter Your Profile Details</h1>
    <form id="inputForm">
      <label for="inputName">Name:</label>
      <input type="text" id="inputName" name="inputName" required aria-required="true" /><br>
      <label for="inputEmail">Email:</label>
      <input type="email" id="inputEmail" name="inputEmail" required aria-required="true" /><br>
<label for="inputMobile">Mobile:</label>
<input type="tel" id="inputMobile" name="inputMobile" pattern="[0-9]{10}" title="Enter 10 digit mobile number" required aria-required="true" /><br>
      <label for="inputAge">Age:</label>
      <input type="number" id="inputAge" name="inputAge" min="0" max="120" required aria-required="true" /><br>
      <label for="inputGender">Gender:</label>
      <select id="inputGender" name="inputGender" required aria-required="true"><br>
        <option value="">Select Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select><br>
      <button type="submit" aria-label="Submit Profile Details">Submit</button>
    </form>
  </div>

  <div id="profileDisplay" class="container" role="main" aria-label="User Profile" style="display:none;">
    <h1>My Profile</h1>
    <div class="profile-field">
      <span class="profile-label">Name:</span>
      <span class="profile-value" id="nameValue">Loading...</span>
    </div>
    <div class="profile-field">
      <span class="profile-label">Email:</span>
      <span class="profile-value" id="emailValue">Loading...</span>
    </div>
    <div class="profile-field">
      <span class="profile-label">Mobile:</span>
      <span class="profile-value" id="mobileValue">Loading...</span>
    </div>
    <div class="profile-field">
      <span class="profile-label">Age:</span>
      <span class="profile-value" id="ageValue">Loading...</span>
    </div>
    <div class="profile-field">
      <span class="profile-label">Gender:</span>
      <span class="profile-value" id="genderValue">Loading...</span>
    </div>
    <div id="priorityBadge" class="badge" style="display:none;">Priority User (Elderly)</div>
    <div>
      <button id="editProfileBtn" aria-label="Edit Profile">Edit Profile</button>
      <button id="logoutBtn" aria-label="Logout">Logout</button>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div id="editModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
    <div class="modal-content">
      <h2 id="modalTitle">Edit Profile</h2>
      <form id="editProfileForm">
        <label for="editName">Name:</label>
        <input type="text" id="editName" name="editName" required aria-required="true" />
        <label for="editEmail">Email:</label>
        <input type="email" id="editEmail" name="editEmail" required aria-required="true" />
        <label for="editMobile">Mobile:</label>
        <input type="tel" id="editMobile" name="editMobile" pattern="\\d{10}" title="Enter 10 digit mobile number" required aria-required="true" />
        <label for="editAge">Age:</label>
        <input type="number" id="editAge" name="editAge" min="0" max="120" required aria-required="true" />
        <label for="editGender">Gender:</label>
        <select id="editGender" name="editGender" required aria-required="true">
          <option value="">Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
        <div class="modal-buttons">
          <button type="submit" aria-label="Save Profile">Save</button>
          <button type="button" id="cancelBtn" aria-label="Cancel Edit">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const profileInputForm = document.getElementById('profileInputForm');
      const inputForm = document.getElementById('inputForm');
      const profileDisplay = document.getElementById('profileDisplay');
      const nameValue = document.getElementById('nameValue');
      const emailValue = document.getElementById('emailValue');
      const mobileValue = document.getElementById('mobileValue');
      const ageValue = document.getElementById('ageValue');
      const genderValue = document.getElementById('genderValue');
      const priorityBadge = document.getElementById('priorityBadge');
      const editProfileBtn = document.getElementById('editProfileBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      const editModal = document.getElementById('editModal');
      const editProfileForm = document.getElementById('editProfileForm');
      const cancelBtn = document.getElementById('cancelBtn');

      // Check if user profile exists
      let loggedInUser = sessionStorage.getItem('loggedInUser');
      if (!loggedInUser) {
        alert('No logged in user found. Redirecting to login.');
        window.location.href = 'index.html';
        return;
      }
      loggedInUser = JSON.parse(loggedInUser);
      const userKey = `userProfile_${loggedInUser.username}`;

      let userDataJson = localStorage.getItem(userKey);
      if (!userDataJson) {
        profileInputForm.style.display = 'block';
        profileDisplay.style.display = 'none';
      } else {
        profileInputForm.style.display = 'none';
        profileDisplay.style.display = 'block';
      }

      // Parse user data if exists
      let userData = userDataJson ? JSON.parse(userDataJson) : null;

      // Function to update profile display
      function updateProfileDisplay() {
        if (!userData) return;
        nameValue.textContent = userData.name || 'N/A';
        emailValue.textContent = userData.email || 'N/A';
        mobileValue.textContent = userData.mobile || 'N/A';
        ageValue.textContent = userData.age !== undefined ? userData.age : 'N/A';
        genderValue.textContent = userData.gender || 'N/A';

        if (userData.age >= 60) {
          priorityBadge.style.display = 'inline-block';
        } else {
          priorityBadge.style.display = 'none';
        }
      }

      // Initial display update
      updateProfileDisplay();

      // Voice greeting using Web Speech API
      if (userData && 'speechSynthesis' in window) {
        const greeting = `Welcome, ${userData.name}`;
        const utterance = new SpeechSynthesisUtterance(greeting);
        window.speechSynthesis.speak(utterance);
      }

      // Handle profile input form submission
      inputForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const inputName = inputForm.inputName.value.trim();
        const inputEmail = inputForm.inputEmail.value.trim();
        const inputMobile = inputForm.inputMobile.value.trim();
        const inputAge = parseInt(inputForm.inputAge.value, 10);
        const inputGender = inputForm.inputGender.value;

        if (!inputName || !inputEmail || !inputMobile || isNaN(inputAge) || !inputGender) {
          alert('Please fill all fields correctly.');
          return;
        }

        userData = {
          name: inputName,
          email: inputEmail,
          mobile: inputMobile,
          age: inputAge,
          gender: inputGender
        };

        localStorage.setItem(userKey, JSON.stringify(userData));

        updateProfileDisplay();

        profileInputForm.style.display = 'none';
        profileDisplay.style.display = 'block';

        // Voice greeting
        if ('speechSynthesis' in window) {
          const greeting = `Welcome, ${userData.name}`;
          const utterance = new SpeechSynthesisUtterance(greeting);
          window.speechSynthesis.speak(utterance);
        }
      });

      // Edit profile button click
      editProfileBtn.addEventListener('click', () => {
        // Pre-fill form with current values
        editProfileForm.editName.value = userData.name || '';
        editProfileForm.editEmail.value = userData.email || '';
        editProfileForm.editMobile.value = userData.mobile || '';
        editProfileForm.editAge.value = userData.age !== undefined ? userData.age : '';
        editProfileForm.editGender.value = userData.gender || '';
        editModal.classList.add('active');
      });

      // Cancel button in modal
      cancelBtn.addEventListener('click', () => {
        editModal.classList.remove('active');
      });

      // Save profile form submit
      editProfileForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const updatedName = editProfileForm.editName.value.trim();
        const updatedEmail = editProfileForm.editEmail.value.trim();
        const updatedMobile = editProfileForm.editMobile.value.trim();
        const updatedAge = parseInt(editProfileForm.editAge.value, 10);
        const updatedGender = editProfileForm.editGender.value;

        if (!updatedName || !updatedEmail || !updatedMobile || isNaN(updatedAge) || !updatedGender) {
          alert('Please fill all fields correctly.');
          return;
        }

        userData.name = updatedName;
        userData.email = updatedEmail;
        userData.mobile = updatedMobile;
        userData.age = updatedAge;
        userData.gender = updatedGender;

        localStorage.setItem(userKey, JSON.stringify(userData));

        updateProfileDisplay();

        editModal.classList.remove('active');

        // Voice greeting
        if ('speechSynthesis' in window) {
          const greeting = `Welcome, ${userData.name}`;
          const utterance = new SpeechSynthesisUtterance(greeting);
          window.speechSynthesis.speak(utterance);
        }
      });

      // Logout button click
      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem(userKey);
        window.location.href = 'index.html';
      });
    });
  </script>
</body>
</html>